@model IEnumerable<PerformanceAPI.Models.IndexModel>

@{
    ViewData["Title"] = "Home Page";
}

    <h1> Home </h1>

@{
    double usedBudget = 0;
    double usedBudgetActual = 0;
    int employeesWithProjections = 0;
    int employeesWithActuals = 0;
    foreach (var item in Model)
    {
        usedBudget += (item.ActualSalary * (item.PredictionSalary + 1));
        employeesWithProjections++;

        usedBudgetActual += item.ActualSalary;
        employeesWithActuals++;
    }

    CurrentUserModel.CurrentBudgetUsed = Convert.ToDouble(usedBudget);
    CurrentUserModel.NumberOfEmployeesWithProjections = employeesWithProjections;
    CurrentUserModel.NumberOfEmployeesWithActuals = employeesWithActuals;

    @if (CurrentUserModel.CurrentBudge - CurrentUserModel.CurrentBudgetUsed < 0)
    {
        CurrentUserModel.OverBudgetAmount = CurrentUserModel.CurrentBudge - CurrentUserModel.CurrentBudgetUsed;
    }
}
<p class="hidden-data" id="current-budget">@CurrentUserModel.CurrentBudge</p>
<p class="hidden-data" id="used-budget">@CurrentUserModel.CurrentBudgetUsed</p>
<p class="hidden-data" id="employees-done">@CurrentUserModel.NumberOfEmployeesWithProjections</p>
<p class="hidden-data" id="employees-done">@CurrentUserModel.NumberOfEmployeesWithActuals</p>
<p class="hidden-data" id="employees-total">@CurrentUserModel.NumberOfEmployees</p>


<section class="container">

	<div class="text-center">
		<div class="box" id="employee-tree">
			<h2>Employees</h2>
			<ul id="EmployeeTree">
				<li>
					@foreach (var item in Model)
					{
						if (item.SupervisorID == CurrentUserModel.CurrentEmployeeID)
						{
							<span class="maroon-link"> @Html.ActionLink(item.FirstName + item.LastName, "Employee", new { id = item.EmployeeID })</span>
							<ul>
								<li>
									@foreach (var i2 in item.etvModelList)
									{
										if (i2.SupervisorID == item.EmployeeID)
										{
											<span class="maroon-link">@Html.ActionLink(i2.EmployeeFirstName + i2.EmployeeLastName, "Employee", new { id = i2.EmployeeID })</span>
											<ul>
												<li>
													@foreach (var i3 in item.etvModelList)
													{
														if (i3.SupervisorID == i2.EmployeeID)
														{
															<span class="maroon-link"> @Html.ActionLink(i3.EmployeeFirstName + i3.EmployeeLastName, "Employee", new { id = i3.EmployeeID })</span>
															<ul>
																<li>
																	@foreach (var i4 in item.etvModelList)
																	{
																		if (i4.SupervisorID == i3.EmployeeID)
																		{
																			<span class="maroon-link"> @Html.ActionLink(i4.EmployeeFirstName + i4.EmployeeLastName, "Employee", new { id = i4.EmployeeID })</span>
																			<ul>
																				<li>
																					@foreach (var i5 in item.etvModelList)
																					{
																						if (i5.SupervisorID == i4.EmployeeID)
																						{
																							<span class="maroon-link"> @Html.ActionLink(i5.EmployeeFirstName + i5.EmployeeLastName, "Employee", new { id = i5.EmployeeID })</span>
																						}
																					}
																				</li>
																			</ul>
																		}
																	}
																</li>
															</ul>
														}
													}
												</li>
											</ul>
										}
									}
								</li>
							</ul>
						}
					}
			</ul>
		</div>
	</div>

	<div class="rightPane">
		<div class="pieChartDiv">

			<table id="predictions-report-charts">
				<tr>
					<td>
						@if (CurrentUserModel.OverBudgetAmount < 0)
						{
							<h3>You are overbudget by:</h3>
							<h3>@CurrentUserModel.GetFormattedOverBudgetAmount()</h3>
						}
						else
						{
							<div id="budget-chart"></div>
						}

					</td>
					<td><div id="projections-chart"></div></td>

					<td><div id="actuals-chart"></div></td>
				</tr>
			</table>
		</div>


		<div class="tableDiv">
			<table class=" table table-bordered table-striped">
				<thead class=" thead-dark">
					<!--<td colspan="9" scope="colgroup">Predictions not actualized</td> -->
					<tr>
						<th>
							Name
						</th>
						<th>
							Position
						</th>
						<th>
							Projected Rating
						</th>
						<th>
							Actual Rating
						</th>
						<th>
							Projected Pay Increase 
						</th>
						<th>
							Projected Salary
						</th>

					</tr>
				</thead>
				<tbody>
					@foreach (var item in Model)
					{
						<tr>
							<td>
								@Html.DisplayFor(model => item.LastName), @Html.DisplayFor(model => item.FirstName) @Html.DisplayFor(model => item.MiddleInitial)
							</td>
							<td>
								@Html.DisplayFor(model => item.PositionName)
							</td>
							<td>
								@Html.DisplayFor(model => item.PredictionRating)
							</td>
							<td>
								@Html.DisplayFor(model => item.ActualRating)
							</td>
							<td>
								@Html.DisplayFor(model => item.PredictionSalary)%
							</td>
							<td>
								$@Html.DisplayFor(model => item.ActualSalary)
							</td>


						</tr>
					}
				</tbody>
			</table>
		</div>
	</div>


</section>

<script src="~/js/BudgetPirChart.js"></script>
<script src="~/js/ProjectionsDoneChart.js"></script>
<script src="~/js/ActualsDoneChart.js"></script>
